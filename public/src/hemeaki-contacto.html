<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">

<dom-module id="hemeaki-contacto">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }

            @media screen and (max-width: 600px) {
                :host {
                    min-height: calc(100vh - 106px);
                }
            }

            :root {
                --paper-input-container-color: black;
                --paper-input-container-focus-color: #E8172B;
            }

            paper-button {
                background-color: #E8172B;
                color: white;
                width: 120px;
                height: 18px;
                padding: 20px;
                font-size: 14px;
                text-transform: none;
                font-family: 'Roboto', sans-serif;
                margin: 0;
            }

            .form-container {
                max-width: 350px;
            }
        </style>

        
        <iron-ajax
            id="contactAjax" 
            url="https://hemeaki-api.herokuapp.com/api/contact"
            method="POST"
            content-type="application/json"
            on-response="trigDialog"></iron-ajax>
        

        <div class="container">
            <h1>Contacto</h1>
            <p>Si quieres ser anunciante o tienes dudas o comentarios, ponte en contacto con nosotros</p>

            
            <div class="form-container">

                <div class="error-container" id="errordiv" hidden>
                    <p>Se ha producido un error al enviar su mensaje, verifique que 
                        todos los campos están llenos y sus datos son correctos</p>
                </div>
                
                <paper-input label="Nombre" allowed-pattern="[a-zA-Z .]" value="{{formData.name}}"></paper-input>
                
                <paper-input label="Apellido" allowed-pattern="[a-zA-Z .]" value="{{formData.lastName}}"></paper-input>
                
                <paper-input label="Email" value="{{formData.email}}"></paper-input>
    
                <paper-input label="Teléfono" allowed-pattern="[0-9- ]" value="{{formData.tel}}"></paper-input>
    
                <paper-textarea placeholder="Mensaje" value="{{formData.message}}"></paper-textarea>
                <br>
                <paper-button raised on-tap="addContact">Enviar</paper-button>
            </div>
            
        </div>

        <paper-dialog id="messageSent">
            <p>Gracias por enviarnos tu mensaje, pronto nos pondremos en contacto contigo</p>
            <div class="buttons">
                <paper-button class="red-btn" on-tap="acceptMsg">Aceptar</paper-button>
            </div>
        </paper-dialog>

    </template>

    <script>

        class HemeakiContacto   extends Polymer.Element {

            static get is() {
                return 'hemeaki-contacto';
            }

            static get properties() {
                return {
                    formData: {
                        type: Object,
                        value: {}
                    }
                };
            }

            validate(value, re) {
                if(re === undefined) {
                    return value !== undefined && value !== '';
                }
                return re.test(value);
            }

            _setReqBody() {
                var form = this.formData
                if (!this.validate(form.name) || !this.validate(form.lastName) || 
                    !this.validate(form.email) || !this.validate(form.tel) ||
                    !this.validate(form.message)) {

                        this.$.errordiv.hidden = false;
                        return;
                }

                this.$.errordiv.hidden = true;
                this.$.contactAjax.body = this.formData;
            }

            addContact() {
                this._setReqBody();
                this.$.contactAjax.generateRequest();
            }

            trigDialog() {
                this.$.messageSent.open();
            }

            acceptMsg() {
                window.location = "/inicio";
            }

        }

        window.customElements.define(HemeakiContacto.   is, HemeakiContacto)  ;
    </script>
</dom-module>