<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<dom-module id="hemeaki-contact">
    <template>
        <style include="shared-styles">
            :host {
                display: block
            }

            .shadow {
                padding: 1em;
                margin-bottom: 1em;
            }

            a {
                color: #E8172B;
            }

            .red-btn {
                margin-left: 5px;
            }
        </style>

        <iron-ajax
            auto
            url="https://hemeaki-api.herokuapp.com/api/contacts"
            handle-as="json"
            last-response="{{contactos}}"></iron-ajax>

        <iron-ajax
            id="deletecontactAjax"
            method="DELETE"
            handle-as="json"
            on-response="refresh"></iron-ajax>

        <h1 style="margin-top: 1em">Solicitudes de contacto</h1>

        
        <template is="dom-repeat" items="{{contactos.contacts}}">

            <div class="shadow">
                <div>
                    <h3>[[item.name]] [[item.lastName]]</h3>
                    <p>[[item.message]]</p>
                    <p>
                        <a href="mailto:[[item.email]]">[[item.email]]</a> &nbsp;
                        <a href="tel:[[item.tel]]">[[item.tel]]</a>
                    </p>
                    <p style="text-align: right">
                        <paper-icon-button 
                            icon="delete" 
                            style="color: #E8172B" 
                            on-tap="trig"
                            my-id="[[item._id]]"
                            my-name="[[item.name]]"></paper-icon-button> 
                    </p>
                </div>
            </div>

        </template>

        <paper-dialog id="dialog">
            <p>Â¿Seguro que dese eliminar la solicitud de contacto de {{nameContact}}?</p>
            <div class="buttons">
                <paper-button class="red-btn" dialog-dismiss>Cancelar</paper-button>
                <paper-button class="red-btn" on-tap="delete">Aceptar</paper-button>
            </div>
        </paper-dialog>

    </template>

    <script>

        class HemeakiContact extends Polymer.Element {

            static get is() {
                return 'hemeaki-contact';
            }

            static get properties() {
                return {
                    selectedContact: {
                        type: String
                    },
                    nameContact: {
                        type: String
                    }
                };
            }

            trig(e) {
                this.nameContact = e.currentTarget.myName;
                this.selectedContact = e.currentTarget.myId;
                this.$.dialog.open();
            } 

            delete(e) {
                var id = this.selectedContact;
                this.$.deletecontactAjax.url = `https://hemeaki-api.herokuapp.com/api/contact/${id}`
                this.$.deletecontactAjax.generateRequest();
            }

            refresh() {
                window.location.reload();
            }

        }

        window.customElements.define(HemeakiContact.is, HemeakiContact);
    </script>
</dom-module>